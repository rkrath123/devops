Google Cloud run(serverless)
============================
![image](https://user-images.githubusercontent.com/53966749/202352026-439567e0-a8da-4084-bc07-dc0eb1de449d.png)
![image](https://user-images.githubusercontent.com/53966749/202352132-55809765-a8c8-48ac-ac75-0925386ef99b.png)
![image](https://user-images.githubusercontent.com/53966749/202352198-b25f9a52-eab6-4c95-8d85-d66dc03168d3.png)
![image](https://user-images.githubusercontent.com/53966749/202352244-6667033f-4fd5-4ad5-ba00-6a562d0b9218.png)
![image](https://user-images.githubusercontent.com/53966749/202352293-1c36be32-a3ea-498c-b607-3d8ea4ec01a5.png)

Terrafrom+Cloudrun
====================
```
main.tf
-------
resource "google_cloud_run_service" "run-app-from-tf" {
  name = "run-app-from-tf"
  location = "asia-southeast1"
  
  template {
    spec {
      containers {
        image = "gcr.io/google-samples/hello-app:1.0"
        
      }
    }
  }
}

resource "google_cloud_run_service_iam_policy" "pub_access" {
  service = google_cloud_run_service.run-app-from-tf.name
  location = google_cloud_run_service.run-app-from-tf.location
  policy_data = data.google_iam_policy.pub-1.policy_data
}

data "google_iam_policy" "pub-1" {
  binding {
    role = "roles/run.invoker"
    members = [ "allUsers", ]
  }
}


provider.tf
------------
terraform {
  required_providers {
    google = {
      source = "hashicorp/google"
      version = "4.43.0"
    }
  }
}


provider "google" {
  # Configuration options
  project = "vsha-ramakant-3568233425114030"
  region = "us-central1"
  zone = "us-central1-a"
  credentials = "ramakant-key.json"
}


terraform apply
---------------
PS C:\Users\rathram\OneDrive - Hewlett Packard Enterprise\terraform\run> terraform  apply  
data.google_iam_policy.pub-1: Reading...
data.google_iam_policy.pub-1: Read complete after 0s [id=844111882]

Terraform used the selected providers to generate the following execution plan. Resource actions are indicated with the following symbols:
  + create

Terraform will perform the following actions:

  # google_cloud_run_service.run-app-from-tf will be created
  + resource "google_cloud_run_service" "run-app-from-tf" {
      + autogenerate_revision_name = false
      + id                         = (known after apply)
      + location                   = "asia-southeast1"
      + name                       = "run-app-from-tf"
      + project                    = (known after apply)
      + status                     = (known after apply)

      + metadata {
          + annotations      = (known after apply)
          + generation       = (known after apply)
          + labels           = (known after apply)
          + namespace        = (known after apply)
          + resource_version = (known after apply)
          + self_link        = (known after apply)
          + uid              = (known after apply)
        }

      + template {
          + metadata {
              + annotations      = (known after apply)
              + generation       = (known after apply)
              + labels           = (known after apply)
              + name             = (known after apply)
              + namespace        = (known after apply)
              + resource_version = (known after apply)
              + self_link        = (known after apply)
              + uid              = (known after apply)
            }

          + spec {
              + container_concurrency = (known after apply)
              + service_account_name  = (known after apply)
              + serving_state         = (known after apply)
              + timeout_seconds       = (known after apply)

              + containers {
                  + image = "gcr.io/google-samples/hello-app:1.0"

                  + ports {
                      + container_port = (known after apply)
                      + name           = (known after apply)
                      + protocol       = (known after apply)
                    }

                  + resources {
                      + limits   = (known after apply)
                      + requests = (known after apply)
                    }
                }
            }
        }

      + traffic {
          + latest_revision = (known after apply)
          + percent         = (known after apply)
          + revision_name   = (known after apply)
          + tag             = (known after apply)
          + url             = (known after apply)
        }
    }

  # google_cloud_run_service_iam_policy.pub_access will be created
  + resource "google_cloud_run_service_iam_policy" "pub_access" {
      + etag        = (known after apply)
      + id          = (known after apply)
      + location    = "asia-southeast1"
      + policy_data = jsonencode(
            {
              + bindings = [
                  + {
                      + members = [
                          + "allUsers",
                        ]
                      + role    = "roles/run.invoker"
                    },
                ]
            }
        )
      + project     = (known after apply)
      + service     = "run-app-from-tf"
    }

Plan: 2 to add, 0 to change, 0 to destroy.

Do you want to perform these actions?
  Terraform will perform the actions described above.
  Only 'yes' will be accepted to approve.

  Enter a value: yes

google_cloud_run_service.run-app-from-tf: Creating...
google_cloud_run_service.run-app-from-tf: Still creating... [10s elapsed]
google_cloud_run_service.run-app-from-tf: Still creating... [20s elapsed]
google_cloud_run_service.run-app-from-tf: Creation complete after 20s [id=locations/asia-southeast1/namespaces/vsha-ramakant-3568233425114030/services/run-app-from-tf]google_cloud_run_service_iam_policy.pub_access: Creating...
google_cloud_run_service_iam_policy.pub_access: Creation complete after 4s [id=v1/projects/vsha-ramakant-3568233425114030/locations/asia-southeast1/services/run-app-from-tf]

Apply complete! Resources: 2 added, 0 changed, 0 destroyed.



```
![image](https://user-images.githubusercontent.com/53966749/202353707-f918c27b-82f2-4351-ab42-3e464f1dee1d.png)

![image](https://user-images.githubusercontent.com/53966749/202355022-8ab5b0e8-d561-40a3-a705-4e5ffa3f5936.png)


terraform destroy
=================

```
PS C:\Users\rathram\OneDrive - Hewlett Packard Enterprise\terraform\run> terraform  destroy
data.google_iam_policy.pub-1: Reading...
data.google_iam_policy.pub-1: Read complete after 0s [id=844111882]
google_cloud_run_service.run-app-from-tf: Refreshing state... [id=locations/asia-southeast1/namespaces/vsha-ramakant-3568233425114030/services/run-app-from-tf]
google_cloud_run_service_iam_policy.pub_access: Refreshing state... [id=v1/projects/vsha-ramakant-3568233425114030/locations/asia-southeast1/services/run-app-from-tf]

Terraform used the selected providers to generate the following execution plan. Resource actions are indicated with the following symbols:
  - destroy

Terraform will perform the following actions:

  # google_cloud_run_service.run-app-from-tf will be destroyed
  - resource "google_cloud_run_service" "run-app-from-tf" {   
      - autogenerate_revision_name = false -> null
      - id                         = "locations/asia-southeast1/namespaces/vsha-ramakant-3568233425114030/services/run-app-from-tf" -> null
      - location                   = "asia-southeast1" -> null
      - name                       = "run-app-from-tf" -> null
      - project                    = "vsha-ramakant-3568233425114030" -> null
      - status                     = [
          - {
              - conditions                   = [
                  - {
                      - message = ""
                      - reason  = ""
                      - status  = "True"
                      - type    = "Ready"
                    },
                  - {
                      - message = ""
                      - reason  = ""
                      - status  = "True"
                      - type    = "ConfigurationsReady"
                    },
                  - {
                      - message = ""
                      - reason  = ""
                      - status  = "True"
                      - type    = "RoutesReady"
                    },
                ]
              - latest_created_revision_name = "run-app-from-tf-9b89s"
              - latest_ready_revision_name   = "run-app-from-tf-9b89s"
              - observed_generation          = 1
              - url                          = "https://run-app-from-tf-mulr4grxua-as.a.run.app"
            },
        ] -> null

      - metadata {
          - annotations      = {
              - "run.googleapis.com/ingress"        = "all"
              - "run.googleapis.com/ingress-status" = "all"
              - "serving.knative.dev/creator"       = "vshasta-vsha-ramakant@vsha-ramakant-3568233425114030.iam.gserviceaccount.com"
              - "serving.knative.dev/lastModifier"  = "vshasta-vsha-ramakant@vsha-ramakant-3568233425114030.iam.gserviceaccount.com"
            } -> null
          - generation       = 1 -> null
          - labels           = {
              - "cloud.googleapis.com/location" = "asia-southeast1"
            } -> null
          - namespace        = "vsha-ramakant-3568233425114030" -> null
          - resource_version = "AAXtoyh3LkA" -> null
          - self_link        = "/apis/serving.knative.dev/v1/namespaces/798438433016/services/run-app-from-tf" -> null
          - uid              = "f6c59c01-a92a-4962-be52-a4f32461069c" -> null
        }

      - template {
          - metadata {
              - annotations = {
                  - "autoscaling.knative.dev/maxScale" = "100"
                } -> null
              - generation  = 0 -> null
              - labels      = {} -> null
            }

          - spec {
              - container_concurrency = 80 -> null
              - service_account_name  = "798438433016-compute@developer.gserviceaccount.com" -> null
              - timeout_seconds       = 300 -> null

              - containers {
                  - args    = [] -> null
                  - command = [] -> null
                  - image   = "gcr.io/google-samples/hello-app:1.0" -> null

                  - ports {
                      - container_port = 8080 -> null
                      - name           = "http1" -> null
                    }

                  - resources {
                      - limits   = {
                          - "cpu"    = "1000m"
                          - "memory" = "512Mi"
                        } -> null
                      - requests = {} -> null
                    }
                }
            }
        }

      - traffic {
          - latest_revision = true -> null
          - percent         = 100 -> null
        }
    }

  # google_cloud_run_service_iam_policy.pub_access will be destroyed
  - resource "google_cloud_run_service_iam_policy" "pub_access" {
      - etag        = "BwXtoyjwd3I=" -> null
      - id          = "v1/projects/vsha-ramakant-3568233425114030/locations/asia-southeast1/services/run-app-from-tf" -> null
      - location    = "asia-southeast1" -> null
      - policy_data = jsonencode(
            {
              - bindings = [
                  - {
                      - members = [
                          - "allUsers",
                        ]
                      - role    = "roles/run.invoker"
                    },
                ]
            }
        ) -> null
      - project     = "vsha-ramakant-3568233425114030" -> null
      - service     = "v1/projects/vsha-ramakant-3568233425114030/locations/asia-southeast1/services/run-app-from-tf" -> null
    }

Plan: 0 to add, 0 to change, 2 to destroy.

Do you really want to destroy all resources?
  Terraform will destroy all your managed infrastructure, as shown above.
  There is no undo. Only 'yes' will be accepted to confirm.

  Enter a value: yes

google_cloud_run_service_iam_policy.pub_access: Destroying... [id=v1/projects/vsha-ramakant-3568233425114030/locations/asia-southeast1/services/run-app-from-tf]
google_cloud_run_service_iam_policy.pub_access: Destruction complete after 3s
google_cloud_run_service.run-app-from-tf: Destroying... [id=locations/asia-southeast1/namespaces/vsha-ramakant-3568233425114030/services/run-app-from-tf]
google_cloud_run_service.run-app-from-tf: Destruction complete after 1s

Destroy complete! Resources: 2 destroyed.
```
