Security
=========
In the video, we had seen how the sample kubeconfig file was making use of certificates for authentication. 
Depending on the service provider, the provider can use any of the authentication modes, it can be certificates, tokens, etc.

In the older Digital Ocean based K8s cluster, the kubeconfig file used certificates. However, the newer one makes use of bearer tokens.

Replace the IP and Token in the below command based on your environment

curl -k https://IP-HERE:/api/v1/ --header "Authorization: Bearer $TOKEN" 


![image](https://user-images.githubusercontent.com/53966749/200806929-8ca11fa3-6935-4a7e-b505-1f193909642a.png)
![image](https://user-images.githubusercontent.com/53966749/200807083-e7439f5c-dd57-42b2-bf6b-48226ab0ed34.png)

Bearer token
=============
![image](https://user-images.githubusercontent.com/53966749/200813255-2ad4c798-f0ed-4f43-a870-26be5885e39d.png)

 Asymmetric Key Encryption
 ==========================
 ![image](https://user-images.githubusercontent.com/53966749/200815087-83ec9beb-9613-41c1-be71-defb0d32a2c5.png)
![image](https://user-images.githubusercontent.com/53966749/200815386-c4539d73-5a06-4443-bcb6-9a7ce9c49a42.png)
![image](https://user-images.githubusercontent.com/53966749/200815545-a8c3aa83-d387-4c2a-bc17-a4b7032ac730.png)
 ![image](https://user-images.githubusercontent.com/53966749/200815917-156f1c19-9a5e-49d9-9eb1-633eb4d42820.png)
![image](https://user-images.githubusercontent.com/53966749/200816216-f29e28be-070e-48b2-a82a-3b5a7fcc6dbd.png)
![image](https://user-images.githubusercontent.com/53966749/200816278-5ada4487-d8df-4de4-b82d-04dc3f253dcb.png)
![image](https://user-images.githubusercontent.com/53966749/200816436-99469c17-43c5-43c3-b0f7-2e5fe43a9d72.png)
![image](https://user-images.githubusercontent.com/53966749/200816968-23f96f9f-bc1b-4d89-8e69-4b7fcfde5021.png)
![image](https://user-images.githubusercontent.com/53966749/200817069-94298ac4-f5ad-407a-8048-cf8c56b27193.png)


Understanding SSLTLS
=======================
![image](https://user-images.githubusercontent.com/53966749/200817376-ce617ccc-bd6e-421a-abb2-ad74791957d0.png)
![image](https://user-images.githubusercontent.com/53966749/200817823-34703130-9c8f-4019-95e5-1afc994e627a.png)
![image](https://user-images.githubusercontent.com/53966749/200818115-c67e96ba-5580-4e70-b832-9a369dda538a.png)
![image](https://user-images.githubusercontent.com/53966749/200818332-80e35029-0faf-4bb1-9cc6-63fe46fc1760.png)
![image](https://user-images.githubusercontent.com/53966749/200819234-bdf9eea3-66d1-443d-8545-4478b4ccdf12.png)

Certhificat based authentication k8s
===================================

![image](https://user-images.githubusercontent.com/53966749/200819483-bac11423-96f9-40a8-8d0a-2c2b168c2d1f.png)
![image](https://user-images.githubusercontent.com/53966749/200819815-814ff3e3-6966-4846-b7b6-1660025e21cf.png)
![image](https://user-images.githubusercontent.com/53966749/200819876-2fba9fe1-c404-4ac4-9495-392d24683f97.png)

```
Pre-Requisite:
- Create a Linux container / Linux server were we can run openssl commands.
yum -y install openssl nano
- Connect the linux box with existing K8s setup.

Kubectl Installation:
curl -LO https://storage.googleapis.com/kubernetes-release/release/`curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt`/bin/linux/amd64/kubectl

Step 1: Create a new private key  and CSR

openssl genrsa -out zeal.key 2048
openssl req -new -key zeal.key -out zeal.csr -subj "/CN=zeal/O=kplabs"

Step 2: Encode the csr
cat zeal.csr | base64 | tr -d '\n'

Step 3: Generate the Kubernetes Signing Request 

Use this config format if you are using Kubernetes Version Earlier then 1.22

apiVersion: certificates.k8s.io/v1beta1
kind: CertificateSigningRequest
metadata:
  name: zeal-csr
spec:
  groups:
  - system:authenticated
  request: 
  usages:
  - digital signature
  - key encipherment
  - client auth

Use this config format if you are using Kubernetes Version Above 1.22

apiVersion: certificates.k8s.io/v1
kind: CertificateSigningRequest
metadata:
  name: zeal-csr
spec:
  signerName: kubernetes.io/kube-apiserver-client
  groups:
  - system:authenticated
  request: 
  usages:
  - digital signature
  - key encipherment
  - client auth

Step 4: Apply the Signing Requests:

kubectl apply -f signingrequest.yaml

Step 5: Approve the csr

kubectl certificate approve zeal-csr

Step 6: Download the Certificate from csr

kubectl get csr zeal-csr -o jsonpath='{.status.certificate}' | base64 -d > zeal.crt

Step 7: Create a new context

kubectl config set-credentials zeal --client-certificate=zeal.crt --client-key=zeal.key

Step 8: Set new Context

kubectl config set-context zeal-context --cluster do-blr1-kplabs-k8s --user=zeal

Step 9: Use Context to Verify

kubectl --context=zeal-context get pods

```

![image](https://user-images.githubusercontent.com/53966749/200822369-d1b1b1af-1c7e-4b0b-b392-5473e141eab2.png)
